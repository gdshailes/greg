<p id="notice"><%= notice %></p>

<h1>
  <span><%= @account.name %></span>Transactions
</h1>

<% if @transactions.any? || @upcoming_bills.any? %>
  <div class='transactions-table'>
    <div class='table-row-header'>
      <span class="table-cell header">Date</span>
      <span class="table-cell header">Description</span>
      <span class="table-cell header">Amount</span>
      <span class="table-cell header">Balance</span>
    </div>

    <% @rt = (@account.reconciled_balance || 0) + (@account.opening_balance || 0) %>

    <% @transactions.each do |transaction| %>
      <% @rt += transaction.amount %>
      <%= link_to edit_finances_account_transaction_path(@account, transaction), class:  'table-row' do %>
        <span class="table-cell"><%= transaction.transaction_date.strftime('%d/%m/%Y') %></span>
        <span class="table-cell"><%= transaction.description %></span>
        <span class="table-cell amount <%= 'deposit' if transaction.amount > 0 %>"><%= transaction.amount.abs %></span>
        <span class="table-cell amount"><%= @rt %></span>
      <% end %>
    <% end %>

    <% @upcoming_bills.each do |bill| %>
      <% @rt += bill[:transaction].amount %>
      <%= link_to finances_account_bill_record_payment_path(@account, bill[:bill_id]), class: 'table-row upcoming-bill', method: :patch do %>
        <span class="table-cell"><%= bill[:transaction].transaction_date.strftime('%d/%m/%Y') %></span>
        <span class="table-cell"><%= bill[:transaction].description %></span>
        <span class="table-cell amount <%= 'deposit' if bill[:transaction].amount > 0 %>"><%= bill[:transaction].amount.abs %></span>
        <span class="table-cell amount"><%= @rt %></span>
      <% end %>
    <% end %>

  </div>
<% else %>
  <p>There are currently no transactions to show for this account.</p>
<% end %>
